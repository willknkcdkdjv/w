<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DOGE</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div id="app">
    <canvas id="game" width="800" height="500"></canvas>

    <div id="ui">
      <div id="panel-login" class="panel">
        <div class="title">LOGIN</div>
        <div class="hint">Email + Name (Name is the password)</div>

        <div class="row">
          <label>Email</label>
          <input id="emailInput" type="email" placeholder="you@example.com" />
        </div>

        <div class="row">
          <label>Name (Password)</label>
          <input id="loginNameInput" maxlength="12" placeholder="Player" />
        </div>

        <div class="row buttons">
          <button id="loginBtn">Login</button>
        </div>

        <div id="loginError" class="hint" style="color:#c00; display:none;"></div>
      </div>
      <div id="panel-menu" class="panel hidden">
        <div class="title">DOGE</div>
        <div class="hint">Press Enter to Start</div>
        <div class="hint small">Controls: A / D or ← → to dodge</div>

        <div class="row">
          <label>Name</label>
          <input id="nameInput" maxlength="12" placeholder="Player" />
        </div>

        <div class="row buttons">
          <button id="startBtn">Start</button>
        </div>

        <div class="lb">
          <div class="lb-title">Leaderboard</div>
          <div class="lb-cols">
            <div>
              <div class="lb-sub">Top 5 (Longest)</div>
              <ol id="bestList"></ol>
            </div>
            <div>
              <div class="lb-sub">Top 5 (Shortest)</div>
              <ol id="worstList"></ol>
            </div>
          </div>
          <div class="stats">
            <div id="accountName"></div>
            <div id="bestTime"></div>
            <div id="gamesPlayed"></div>
            <div id="avgTime"></div>
          </div>
        </div>
      </div>

      <div id="panel-countdown" class="panel hidden">
        <div id="countText" class="count">3</div>
      </div>

      <div id="panel-playing" class="panel hidden">
        <div class="hud">
          <div id="timeText">Time: 0.00s</div>
        </div>
      </div>

      <div id="panel-gameover" class="panel hidden">
        <div class="title">GAME OVER</div>
        <div class="bigline">
          <span id="finalTime" class="huge">0.00</span>
          <span class="sec">seconds</span>
        </div>
        <div id="killedBy" class="killed">Kill by ???</div>
        <div id="record" class="record hidden">RECORD BREAKING</div>
        <div class="hint">Press Enter to Restart</div>

        <div class="lb">
          <div class="lb-title">Leaderboard</div>
          <div class="lb-cols">
            <div>
              <div class="lb-sub">Top 5 (Longest)</div>
              <ol id="bestList2"></ol>
            </div>
            <div>
              <div class="lb-sub">Top 5 (Shortest)</div>
              <ol id="worstList2"></ol>
            </div>
          </div>
          <div class="stats">
            <div id="accountName2"></div>
            <div id="bestTime2"></div>
            <div id="gamesPlayed2"></div>
            <div id="avgTime2"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ================= Firebase (一定要先跑) ================= -->
  <script type="module">
    console.log("firebase module script start");

    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
    import {
      getFirestore,
      collection,
      addDoc,
      query,
      orderBy,
      limit,
      getDocs,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

    // ⚠️ 換成你 Firebase Console 給你的「真的 config」
    const firebaseConfig = {
    apiKey: "AIzaSyCb5w8jk77GnaeC9YnZcI6lfwObEXB9nN8",
    authDomain: "doge-9ba16.firebaseapp.com",
    projectId: "doge-9ba16",
    storageBucket: "doge-9ba16.firebasestorage.app",
    messagingSenderId: "353763869004",
    appId: "1:353763869004:web:3410452212d77e893acfe9",
    measurementId: "G-CWDG44YNQ9"
     };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const scoresCol = collection(db, "scores");

    async function submitScore({ name, time, killedBy }) {
      await addDoc(scoresCol, {
        name,
        time,
        killedBy,
        createdAt: serverTimestamp(),
      });
    }

    async function fetchTop(n = 5) {
      const q = query(scoresCol, orderBy("time", "desc"), limit(n));
      const snap = await getDocs(q);
      return snap.docs.map(d => d.data());
    }

    async function fetchBottom(n = 5) {
      const q = query(scoresCol, orderBy("time", "asc"), limit(n));
      const snap = await getDocs(q);
      return snap.docs.map(d => d.data());
    }

    window.fbscores = { submitScore, fetchTop, fetchBottom };
    console.log("firebase ready", window.fbscores);
  </script>

  <!-- ================= Game logic（延後，確保 Firebase 已存在） ================= -->
  <script src="main.js"></script>
</body>
</html>